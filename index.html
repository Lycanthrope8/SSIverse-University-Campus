<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<script type="importmap">
    {
        "imports": {
            "@wonderlandengine/api": "./node_modules/@wonderlandengine/api/index.js",
            "@wonderlandengine/api/decorators.js": "./node_modules/@wonderlandengine/api/index.js"
        }
    }
</script>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="{{ settings.runtime.xrButtonColor }}">
    
    <meta property="og:title" content="{{ settings.project.name }}" />
    <meta property="og:type" content="{{ settings.project.type }}" />
    <meta property="og:description" content="{{ settings.project.description }}" />

    <meta property="twitter:description" content="{{ settings.project.description }}" />
    <meta property="twitter:title" content="{{ settings.project.name }}" />
    <meta property="twitter:card" content="summary_large_image" />

    <title>{{ settings.project.name }}</title>

    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <link rel="modulepreload" href="{{ settings.scripting.application.output }}" as="script">
    {{ if settings.scripting.components.bundling != 'none' }}
    {{ if settings.scripting.components.output != '' }}
    <link rel="modulepreload" href="{{ settings.scripting.components.output }}" as="script">
    {{ end }}
    {{ end }}

    {{ if settings.runtime.pwa.enable }}
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon192.png">

    <script>
        if (navigator.serviceWorker != null) {
            navigator.serviceWorker.register("service-worker.js");
        }
    </script>
    {{ end }}

    <script type="module" src="{{ settings.scripting.application.output }}"></script>

    {{ if settings.runtime.googleAnalytics != "" }}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ settings.runtime.googleAnalytics }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }

        gtag("js", new Date());
        gtag("config", "{{ settings.runtime.googleAnalytics }}");
    </script>

    {{ if settings.runtime.googleAnalyticsSecondary != "" }}
    <script>
        gtag("config", "{{ settings.runtime.googleAnalyticsSecondary }}");
    </script>
    {{ end }}
    {{ end }}

    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0px;

            overflow: hidden;

            background: linear-gradient(180deg, rgb(0, 0, 0) 0%, rgb(0, 0, 0) 30%, rgb(30, 30, 30) 100%);

            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: none;

            -webkit-tap-highlight-color: transparent;
        }

        #xr-buttons-container {
            position: fixed;

            width: 100%;
            bottom: 0px;
            margin-bottom: 30px;

            display: flex;
            justify-content: center;
            gap: 15px;

            pointer-events: none;
        }

        .xr-button {
            width: 100px;
            height: 60px;

            display: block;

            cursor: pointer;
            pointer-events: none;

            opacity: 0;
            transform: scale(0);
            transition: transform 0.85s, opacity 1.25s;
        }

        .xr-button-svg-container {
            width: inherit;
            height: inherit;

            transition: transform 0.35s;
        }

        .xr-button-svg-container:hover {
            transform: scale(1.06);
        }

        .xr-button-svg-container:active {
            transform: scale(0.94);
        }

        .xr-button-svg {
            width: inherit;
            height: inherit;
        }

        .xr-button-svg-label {
            fill: {{ settings.runtime.xrButtonColor }};
        }

        .xr-button-svg-frame {
            stroke: {{ settings.runtime.xrButtonColor }};
        }

        /* This is a value set at runtime when the vr/ar supported state is known */
        [data-supported] {
            transform: scale(1);
        }

        /* If supported, the button is shown */
        [data-supported="true"] {
            opacity: 1;
            pointer-events: all;
        }

        /* If not supported, the buttons is shown but disabled */
        [data-supported="false"] {
            opacity: 0.5;
        }

        /* Cloud Wallet Styles */
        .wallet-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 100001;
            pointer-events: auto;
        }

        .wallet-modal {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            max-width: 90%;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .wallet-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .wallet-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .wallet-close {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .wallet-close:hover {
            background: #333;
            color: #fff;
        }

        .wallet-content {
            padding: 20px;
        }

        .wallet-form-group {
            margin-bottom: 16px;
        }

        .wallet-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #ccc;
        }

        .wallet-input {
            width: 100%;
            padding: 10px 12px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .wallet-input:focus {
            outline: none;
            border-color: #00aaff;
            background: #333;
        }

        .wallet-button {
            width: 100%;
            padding: 12px;
            background: #00aaff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 20px;
        }

        .wallet-button:hover {
            background: #0088cc;
        }

        .wallet-button:active {
            transform: scale(0.98);
        }

        .wallet-divider {
            margin: 20px 0;
            text-align: center;
            position: relative;
        }

        .wallet-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #444;
        }

        .wallet-divider span {
            background: #1a1a1a;
            padding: 0 16px;
            position: relative;
            color: #888;
            font-size: 14px;
        }

        .wallet-info {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 12px;
            margin-top: 16px;
            font-size: 14px;
            color: #ccc;
        }

        .wallet-section {
            margin-bottom: 20px;
        }

        .wallet-section-title {
            font-size: 16px;
            margin-bottom: 12px;
            color: #fff;
        }

        .credential-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .credential-item {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .credential-item:hover {
            background: #333;
            border-color: #555;
        }

        .credential-name {
            font-size: 14px;
            color: #fff;
        }

        .credential-status {
            font-size: 12px;
            color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* Guest button styling */
        #guest-login-btn {
            padding: 0.8em 1.6em;
            font-size: 1em;
            background-color: transparent;
            color: #888;
            border: 1px solid #444;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        #guest-login-btn:hover {
            color: #fff;
            border-color: #666;
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* Landing page button animations */
        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            33% {
                transform: translateY(-30px) rotate(120deg);
            }
            66% {
                transform: translateY(30px) rotate(240deg);
            }
        }

        .landing-btn {
            position: relative;
            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .landing-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transition: width 0.3s ease;
            border-radius: inherit;
        }

        .landing-btn:hover::before {
            width: 100%;
        }

        .landing-btn:hover {
            transform: translateY(-2px);
        }

        .landing-btn:active {
            transform: translateY(0);
        }

        .landing-btn.primary:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .landing-btn.secondary:hover {
            background: rgba(0, 170, 255, 0.1);
            border-color: #00aaff;
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.3);
        }

        .landing-btn.guest:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Ripple effect */
        .landing-btn {
            overflow: hidden;
        }

        .landing-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .landing-btn:active::after {
            width: 300px;
            height: 300px;
        }

        /* Glow effect for primary button */
        @keyframes glow {
            0% {
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 4px 25px rgba(102, 126, 234, 0.6);
            }
            100% {
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            }
        }

        .landing-btn.primary {
            animation: glow 3s infinite;
        }

        /* Wallet modal improvements */
        .wallet-modal {
            backdrop-filter: blur(20px);
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Particle effect */
        @keyframes particle {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0;
            }
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(102, 126, 234, 0.6);
            border-radius: 50%;
            animation: particle 10s linear infinite;
        }

        /* Ripple effect styles */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0);
            animation: ripple-animation 0.6s ease-out;
            pointer-events: none;
        }

        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            #landing-page h1 {
                font-size: 2.5em !important;
            }
            
            #landing-page p {
                font-size: 1em !important;
                padding: 0 20px;
            }
            
            .landing-btn {
                font-size: 1em !important;
                padding: 14px 30px !important;
            }
            
            .wallet-modal {
                width: 95%;
                max-width: 400px;
            }
        }

        /* Loading animation for wallet operations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #00aaff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        /* Success checkmark animation */
        @keyframes checkmark {
            0% {
                stroke-dashoffset: 50;
            }
            100% {
                stroke-dashoffset: 0;
            }
        }

        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #00ff88;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #00ff88;
            stroke-miterlimit: 10;
            margin: 10% auto;
            box-shadow: inset 0px 0px 0px #00ff88;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }

        .checkmark-check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: checkmark 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }

        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px rgba(0, 255, 136, 0.1);
            }
        }
    </style>
</head>

<body>
    <canvas id="canvas" style="width: 100%; height: 100%; display: none;" tabindex="0"></canvas>
    
    <!-- Landing page with login options -->
    <div id="landing-page" style="
        position: fixed;
        z-index: 99999;
        width: 100vw;
        height: 100vh;
        background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f1e 50%, #050510 100%);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        pointer-events: auto;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    ">
        <h1 style="
            font-size: 3.5em;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #00aaff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            letter-spacing: -1px;
        ">SSIverse University Campus</h1>
        
        <p style="
            font-size: 1.2em;
            color: #888;
            margin-bottom: 60px;
            text-align: center;
            font-weight: 300;
            letter-spacing: 0.5px;
        ">Secure Self-Sovereign Identity for Metaverse Education</p>
        
        <div style="
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        ">
            <button id="signup-wallet-btn" class="landing-btn primary" style="
                padding: 16px 40px;
                font-size: 1.1em;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 30px;
                cursor: pointer;
                font-weight: 600;
                letter-spacing: 0.5px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                position: relative;
                overflow: hidden;
            ">
                <span style="position: relative; z-index: 1;">SIGN-UP WITH SSI</span>
            </button>
            
            <button id="wallet-login-btn" class="landing-btn secondary" style="
                padding: 16px 40px;
                font-size: 1.1em;
                background: transparent;
                color: #00aaff;
                border: 2px solid #00aaff;
                border-radius: 30px;
                cursor: pointer;
                font-weight: 600;
                letter-spacing: 0.5px;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            ">
                <span style="position: relative; z-index: 1;">LOGIN WITH SSI</span>
            </button>
        </div>

        <button id="guest-login-btn" class="landing-btn guest" style="
            padding: 14px 36px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.05);
            color: #888;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        ">
            AS GUEST
        </button>

        <!-- Animated background elements -->
        <div class="bg-animation" style="
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        ">
            <div class="bg-circle" style="
                position: absolute;
                width: 300px;
                height: 300px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
                animation: float 20s infinite ease-in-out;
                top: -150px;
                left: -150px;
            "></div>
            <div class="bg-circle" style="
                position: absolute;
                width: 400px;
                height: 400px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(118, 75, 162, 0.1) 0%, transparent 70%);
                animation: float 25s infinite ease-in-out reverse;
                bottom: -200px;
                right: -200px;
            "></div>
            <div class="bg-circle" style="
                position: absolute;
                width: 250px;
                height: 250px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(0, 170, 255, 0.1) 0%, transparent 70%);
                animation: float 30s infinite ease-in-out;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            "></div>
        </div>
    </div>

    <!-- Cloud Wallet Modal -->
    <div id="wallet-modal-overlay" class="wallet-modal-overlay">
        <div class="wallet-modal">
            <div class="wallet-header">
                <h2 class="wallet-title" id="wallet-modal-title">SSI Cloud Wallet</h2>
                <button class="wallet-close" id="wallet-close-btn">&times;</button>
            </div>
            
            <div class="wallet-content" id="wallet-content">
                <!-- Content will be dynamically inserted based on login/signup -->
            </div>
        </div>
    </div>

    <div id="xr-buttons-container">
        {{ if settings.xr.vr.enable }}
        <a id="vr-button" class="xr-button">
            <div class="xr-button-svg-container">
                <svg class="xr-button-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 109.41 65">
                    <rect class="xr-button-svg-frame" x="3.5" y="3.5" width="102.41" height="58" rx="16.68" style="fill:none;stroke-linejoin:round;stroke-width:7px" />
                    <path class="xr-button-svg-label" d="M36.24,48.84a2,2,0,0,1-1.78-1.15L23.39,17.46a1.84,1.84,0,0,1,1.78-1.84h5.45a1.8,1.8,0,0,1,1.66,1.21l7.29,20.42,7.28-20.42a1.8,1.8,0,0,1,1.67-1.21H54a1.84,1.84,0,0,1,1.78,1.84L44.67,47.69a2,2,0,0,1-1.78,1.15Z" />
                    <path class="xr-button-svg-label" d="M70.61,40H68v7a1.84,1.84,0,0,1-1.78,1.84H61.31A1.83,1.83,0,0,1,59.54,47V17.46a1.83,1.83,0,0,1,1.77-1.84H73s13,.12,13,12.22c0,6-3.21,9-6.42,10.5L86.38,47a1.76,1.76,0,0,1-1.77,1.84h-5.8a1.91,1.91,0,0,1-1.43-.69ZM68,32.09h5c2.24,0,4.08-1.15,4.08-4.25s-1.84-4.36-4.08-4.36H68Z" />
                </svg>
            </div>
        </a>
        {{ end }}

        {{ if settings.xr.ar.enable }}
        <a id="ar-button" class="xr-button">
            <div class="xr-button-svg-container">
                <svg class="xr-button-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 109.41 65">
                    <rect class="xr-button-svg-frame" x="3.5" y="3.5" width="102.41" height="58" rx="16.68" style="fill:none;stroke-linejoin:round;stroke-width:7px" />
                    <path class="xr-button-svg-label" d="M42.89,15.62a2,2,0,0,1,1.78,1.15L55.75,47A1.84,1.84,0,0,1,54,48.84H48.52a1.81,1.81,0,0,1-1.67-1.2l-1.49-4.19H33.77l-1.49,4.19a1.8,1.8,0,0,1-1.66,1.2H25.17A1.83,1.83,0,0,1,23.39,47L34.46,16.77a2,2,0,0,1,1.78-1.15Zm-6.31,20h6l-3-8.38Z" />
                    <path class="xr-button-svg-label" d="M70.61,40H68V47a1.84,1.84,0,0,1-1.78,1.83H61.31A1.83,1.83,0,0,1,59.54,47V17.46a1.83,1.83,0,0,1,1.77-1.84H73s13,.12,13,12.22c0,6-3.21,9-6.42,10.5L86.38,47a1.76,1.76,0,0,1-1.77,1.83h-5.8a1.91,1.91,0,0,1-1.43-.69ZM68,32.09h5c2.24,0,4.08-1.15,4.08-4.25s-1.84-4.36-4.08-4.36H68Z" />
                </svg>
            </div>
        </a>
        {{ end }}
    </div>

    <script>
        // Cloud Wallet JavaScript
        const walletModal = document.getElementById('wallet-modal-overlay');
        const walletContent = document.getElementById('wallet-content');
        const walletTitle = document.getElementById('wallet-modal-title');
        const closeBtn = document.getElementById('wallet-close-btn');
        const loginBtn = document.getElementById('wallet-login-btn');
        const signupBtn = document.getElementById('signup-wallet-btn');
        const guestBtn = document.getElementById('guest-login-btn');

        // Particle effect system
        function createParticle() {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * window.innerWidth + 'px';
            particle.style.bottom = '-10px';
            particle.style.animationDelay = Math.random() * 10 + 's';
            particle.style.animationDuration = (Math.random() * 5 + 10) + 's';
            document.querySelector('.bg-animation').appendChild(particle);
            
            setTimeout(() => {
                particle.remove();
            }, 15000);
        }

        // Create particles periodically
        setInterval(createParticle, 2000);

        // Add hover sound effect (optional - requires adding audio files)
        const buttons = document.querySelectorAll('.landing-btn');
        buttons.forEach(btn => {
            btn.addEventListener('mouseenter', () => {
                // Add subtle scale effect
                btn.style.transform = 'translateY(-2px) scale(1.02)';
            });
            
            btn.addEventListener('mouseleave', () => {
                btn.style.transform = 'translateY(0) scale(1)';
            });
        });

        // Wallet state
        let walletState = {
            isAuthenticated: false,
            did: null,
            credentials: [],
            connections: []
        };

        // Close modal function
        function closeWallet() {
            walletModal.style.display = 'none';
        }

        // Open wallet modal
        function openWallet(mode) {
            walletModal.style.display = 'block';
            
            if (mode === 'login') {
                walletTitle.textContent = 'SSI Cloud Wallet - Login';
                showLoginContent();
            } else if (mode === 'signup') {
                walletTitle.textContent = 'SSI Cloud Wallet - Sign Up';
                showSignupContent();
            }
        }

        // Show login content
        function showLoginContent() {
            walletContent.innerHTML = `
                <div class="wallet-form-group">
                    <label class="wallet-label">DID or Wallet ID</label>
                    <input type="text" class="wallet-input" id="login-did" placeholder="did:ssi:xxxxx or wallet ID">
                </div>
                <div class="wallet-form-group">
                    <label class="wallet-label">Passphrase</label>
                    <input type="password" class="wallet-input" id="login-password" placeholder="Enter your passphrase">
                </div>
                <button class="wallet-button" onclick="handleLogin()">Authenticate</button>
                <div class="wallet-divider">
                    <span>or</span>
                </div>
                <button class="wallet-button" style="background: #444;" onclick="scanQRCode()">Scan QR Code</button>
                <div class="wallet-info">
                    Your credentials and identity will be securely managed through the SSI cloud wallet.
                </div>
            `;
        }

        // Show signup content
        function showSignupContent() {
            walletContent.innerHTML = `
                <div class="wallet-form-group">
                    <label class="wallet-label">Full Name</label>
                    <input type="text" class="wallet-input" id="signup-fullname" placeholder="Enter your full name">
                </div>
                <div class="wallet-form-group">
                    <label class="wallet-label">Email Address</label>
                    <input type="email" class="wallet-input" id="signup-email" placeholder="Enter your email address">
                </div>
                <div class="wallet-form-group">
                    <label class="wallet-label">University / Institution</label>
                    <input type="text" class="wallet-input" id="signup-university" value="SSIverse University" readonly style="background: #1a1a1a; color: #888;">
                </div>
                <div class="wallet-form-group">
                    <label class="wallet-label">Passphrase</label>
                    <input type="password" class="wallet-input" id="signup-password" placeholder="Create a secure passphrase">
                </div>
                <button class="wallet-button" onclick="generateDID()" id="generate-did-btn">Generate DID</button>
                <div class="wallet-form-group" id="did-display-group" style="display: none;">
                    <label class="wallet-label">DID Address</label>
                    <input type="text" class="wallet-input" id="generated-did" readonly style="background: #1a1a1a; color: #00ff88; font-family: monospace; font-size: 12px;">
                </div>
                <button class="wallet-button" onclick="createWallet()" id="create-wallet-btn" disabled style="opacity: 0.5; cursor: not-allowed;">Create Wallet</button>
            `;
        }

        // Generate DID function
        function generateDID() {
            const fullname = document.getElementById('signup-fullname').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            if (fullname && email && password) {
                // Show loading state for DID generation
                const generateBtn = document.getElementById('generate-did-btn');
                generateBtn.disabled = true;
                generateBtn.textContent = 'Generating...';
                
                setTimeout(() => {
                    // Generate a sample DID (placeholder for ACA-Py)
                    const did = `did:ssi:${Math.random().toString(36).substr(2, 9)}`;
                    
                    // Show the DID
                    document.getElementById('did-display-group').style.display = 'block';
                    document.getElementById('generated-did').value = did;
                    
                    // Store temporarily
                    walletState.tempDID = did;
                    walletState.tempUserData = { fullname, email, password };
                    
                    // Enable create wallet button
                    const createBtn = document.getElementById('create-wallet-btn');
                    createBtn.disabled = false;
                    createBtn.style.opacity = '1';
                    createBtn.style.cursor = 'pointer';
                    
                    generateBtn.textContent = 'DID Generated ✓';
                    generateBtn.style.background = '#00ff88';
                    generateBtn.style.color = '#000';
                }, 1500);
            } else {
                showErrorMessage('Please fill all fields before generating DID');
            }
        }

        // Create wallet function
        function createWallet() {
            showLoadingState('Creating your wallet...');
            
            setTimeout(() => {
                walletState.isAuthenticated = true;
                walletState.did = walletState.tempDID;
                walletState.userData = walletState.tempUserData;
                
                // Show credential request screen
                showCredentialRequestScreen();
            }, 2000);
        }

        // Show credential request screen
        function showCredentialRequestScreen() {
            walletContent.innerHTML = `
                <div style="text-align: center; padding: 20px 0;">
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" style="width: 60px; height: 60px;">
                        <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                    <h3 style="color: #00ff88; margin-top: 10px;">Wallet Created Successfully!</h3>
                </div>
                
                <div class="wallet-section">
                    <h3 class="wallet-section-title">Your DID</h3>
                    <div class="wallet-info" style="font-family: monospace; font-size: 13px; word-break: break-all;">${walletState.did}</div>
                </div>
                
                <div class="wallet-section">
                    <h3 class="wallet-section-title">Request Credential</h3>
                    <div class="credential-item" style="margin-bottom: 16px;">
                        <span class="credential-name">SSIverse University Student ID</span>
                        <span class="credential-status" style="background: rgba(255, 170, 0, 0.1); color: #ffaa00;">Pending</span>
                    </div>
                    <button class="wallet-button" onclick="requestCredential()">Request Credential</button>
                </div>
            `;
        }

        // Request credential function
        function requestCredential() {
            showLoadingState('Requesting credential from SSIverse University...');
            
            setTimeout(() => {
                // Simulate credential issuance
                walletState.credentials.push({
                    type: 'University Student ID',
                    issuer: 'SSIverse University',
                    status: 'Verified',
                    issuedAt: new Date().toISOString()
                });
                
                showSuccessState('Credential Issued Successfully!');
                
                setTimeout(() => {
                    showAuthenticatedContent();
                }, 1500);
            }, 2000);
        }

        // Show login content
        function showLoginContent() {
            walletContent.innerHTML = `
                <div class="wallet-form-group">
                    <label class="wallet-label">DID</label>
                    <input type="text" class="wallet-input" id="login-did" placeholder="did:ssi:xxxxx" style="font-family: monospace; font-size: 13px;">
                </div>
                <div class="wallet-form-group">
                    <label class="wallet-label">Passphrase</label>
                    <input type="password" class="wallet-input" id="login-password" placeholder="Enter your passphrase">
                </div>
                <button class="wallet-button" onclick="authenticateDID()">Authenticate</button>
                <div class="wallet-divider">
                    <span>or</span>
                </div>
                <button class="wallet-button" style="background: #444;" onclick="scanQRCode()">Scan QR Code</button>
            `;
        }

        // Authenticate DID function
        function authenticateDID() {
            const did = document.getElementById('login-did').value;
            const password = document.getElementById('login-password').value;
            
            if (did && password) {
                showLoadingState('Authenticating...');
                
                setTimeout(() => {
                    walletState.isAuthenticated = true;
                    walletState.did = did;
                    
                    // Mock credential data (would come from ACA-Py)
                    walletState.credentials = [{
                        type: 'University Student ID',
                        issuer: 'SSIverse University',
                        status: 'Verified',
                        claims: {
                            name: 'John Doe',
                            studentId: 'STU-2024-001',
                            program: 'Computer Science',
                            level: 'Undergraduate'
                        }
                    }];
                    
                    showCredentialSharingScreen();
                }, 1500);
            } else {
                showErrorMessage('Please enter both DID and passphrase');
            }
        }

        // Show credential sharing screen
        function showCredentialSharingScreen() {
            const credential = walletState.credentials[0];
            walletContent.innerHTML = `
                <div class="wallet-section">
                    <h3 class="wallet-section-title">Your DID</h3>
                    <div class="wallet-info" style="font-family: monospace; font-size: 13px; word-break: break-all;">${walletState.did}</div>
                </div>
                
                <div class="wallet-section">
                    <h3 class="wallet-section-title">Select Credential to Share</h3>
                    <div class="credential-item" style="border: 2px solid #00aaff; background: rgba(0, 170, 255, 0.05);">
                        <div>
                            <span class="credential-name">${credential.type}</span>
                            <div style="font-size: 12px; color: #888; margin-top: 4px;">Issued by: ${credential.issuer}</div>
                        </div>
                        <span class="credential-status">Verified</span>
                    </div>
                    
                    <div class="wallet-info" style="margin-top: 16px;">
                        <strong>Credential Details:</strong>
                        <div style="margin-top: 8px; font-size: 13px; color: #ccc;">
                            ${credential.claims ? `
                                • Name: ${credential.claims.name}<br>
                                • Student ID: ${credential.claims.studentId}<br>
                                • Program: ${credential.claims.program}<br>
                                • Level: ${credential.claims.level}
                            ` : 'Standard University Credential'}
                        </div>
                    </div>
                    
                    <button class="wallet-button" onclick="shareCredential()" style="margin-top: 20px;">Share Credential</button>
                </div>
            `;
        }

        // Share credential function
        function shareCredential() {
            showLoadingState('Verifying credential...');
            
            setTimeout(() => {
                showSuccessState('Credential Verified Successfully!');
                
                setTimeout(() => {
                    // Show final authenticated view with Enter Metaverse button
                    walletContent.innerHTML = `
                        <div style="text-align: center; padding: 20px 0;">
                            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" style="width: 60px; height: 60px;">
                                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                            </svg>
                            <h3 style="color: #00ff88; margin-top: 10px;">Identity Verified</h3>
                            <p style="color: #888; margin-top: 10px;">You are authenticated as a verified student</p>
                        </div>
                        
                        <button class="wallet-button" onclick="enterMetaverse()" style="
                            background: linear-gradient(135deg, #00ff88 0%, #00aaff 100%);
                            font-size: 18px;
                            padding: 16px;
                            margin-top: 20px;
                        ">Enter Metaverse</button>
                    `;
                }, 1500);
            }, 2000);
        }

        // Show authenticated wallet content (after full authentication)
        function showAuthenticatedContent() {
            walletContent.innerHTML = `
                <div class="wallet-section">
                    <h3 class="wallet-section-title">Your DID</h3>
                    <div class="wallet-info" style="font-family: monospace; font-size: 13px; word-break: break-all;">${walletState.did}</div>
                </div>
                
                <div class="wallet-section">
                    <h3 class="wallet-section-title">Your Credentials</h3>
                    <div class="credential-list" id="credential-list">
                        ${walletState.credentials.map(cred => `
                            <div class="credential-item">
                                <div>
                                    <span class="credential-name">${cred.type}</span>
                                    <div style="font-size: 12px; color: #888; margin-top: 4px;">Issued by: ${cred.issuer}</div>
                                </div>
                                <span class="credential-status">${cred.status}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="wallet-section">
                    <button class="wallet-button" onclick="enterMetaverse()" style="
                        background: linear-gradient(135deg, #00ff88 0%, #00aaff 100%);
                        font-size: 18px;
                        padding: 16px;
                    ">Enter Metaverse</button>
                </div>
            `;
        }

        // Show loading state
        function showLoadingState(message) {
            walletContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="loading-spinner"></div>
                    <p style="color: #888; margin-top: 20px;">${message}</p>
                </div>
            `;
        }

        // Show success state
        function showSuccessState(message) {
            walletContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                    <p style="color: #00ff88; margin-top: 20px; font-weight: 500;">${message}</p>
                </div>
            `;
        }

        // Show error message
        function showErrorMessage(message) {
            // Create error toast
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(255, 0, 0, 0.1);
                border: 1px solid rgba(255, 0, 0, 0.3);
                color: #ff6b6b;
                padding: 16px 24px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 100002;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Add slide animations for toasts
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Scan QR Code (placeholder)
        function scanQRCode() {
            alert('QR Code scanning will be implemented with ACA-Py integration');
        }

        // Enter metaverse
        function enterMetaverse() {
            closeWallet();
            const landing = document.getElementById('landing-page');
            const canvas = document.getElementById('canvas');
            if (canvas) canvas.style.display = 'block';
            if (landing) landing.style.display = 'none';
            
            // Trigger the app.ts login event
            window.dispatchEvent(new CustomEvent('walletAuthenticated', { 
                detail: { did: walletState.did } 
            }));
        }

        // Event listeners
        closeBtn.addEventListener('click', closeWallet);
        loginBtn.addEventListener('click', () => openWallet('login'));
        signupBtn.addEventListener('click', () => openWallet('signup'));
        
        // Guest login
        guestBtn.addEventListener('click', () => {
            const landing = document.getElementById('landing-page');
            const canvas = document.getElementById('canvas');
            if (canvas) canvas.style.display = 'block';
            if (landing) landing.style.display = 'none';
            
            // Trigger guest login event
            window.dispatchEvent(new CustomEvent('guestLogin'));
        });

        // Close modal when clicking outside
        walletModal.addEventListener('click', (e) => {
            if (e.target === walletModal) {
                closeWallet();
            }
        });

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && walletModal.style.display === 'block') {
                closeWallet();
            }
        });

        // Add ripple effect to buttons
        document.querySelectorAll('.landing-btn').forEach(button => {
            button.addEventListener('click', function(e) {
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                ripple.classList.add('ripple');
                
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });
    </script>
</body>

</html>